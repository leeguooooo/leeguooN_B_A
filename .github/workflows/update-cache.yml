name: Update Cache

on:
  schedule:
    # 每分钟运行一次
    - cron: '* * * * *'
  workflow_dispatch: # 允许手动触发

jobs:
  update-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger cache update
        run: |
          curl -X POST ${{ secrets.VERCEL_APP_URL }}/api/webhook/update \
            -H "X-Api-Key: ${{ secrets.API_KEY }}" \
            -H "Content-Type: application/json" \
            --fail \
            --retry 3 \
            --retry-delay 5
      
      - name: Verify cache update
        run: |
          sleep 5
          curl ${{ secrets.KV_BASE_URL }}/games/jrs/last_update \
            -H "Accept: application/json" \
            --fail